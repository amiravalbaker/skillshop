{% extends "base.html" %}
{% load static %}

{% block content %}
<h2>Edit Listing: {{ listing.skill.name }}</h2>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div style="color:red;">{{ form.non_field_errors }}</div>
    {% endif %}

    <p>
        {{ form.skill_choice.label_tag }}<br>
        {{ form.skill_choice }}
    </p>

    <div id="new-skill-box" style="display:none;">
        <p>
            {{ form.new_skill.label_tag }}<br>
            {{ form.new_skill }}
        </p>
    </div>

    <p>
        {{ form.location_text.label_tag }}<br>
        {{ form.location_text }}<br>
        <small>{{ form.location_text.help_text }}</small>
        {% if form.location_text.errors %}
          <div style="color:red;">{{ form.location_text.errors }}</div>
        {% endif %}
    </p>

    {# Show current listing photo if it exists #}
    {% if listing.photo %}
      <p>
        <strong>Current photo:</strong><br>
        <img src="{{ listing.photo.url }}" alt="Listing photo" style="max-width:200px; height:auto;">
      </p>
    {% endif %}

    {# Photo upload field #}
    <p>
      {{ form.photo.label_tag }}<br>
      {{ form.photo }}
      {% if form.photo.errors %}
        <div style="color:red;">{{ form.photo.errors }}</div>
      {% endif %}
    </p>

    <p>{{ form.description.label_tag }}<br>{{ form.description }}</p>
    <p>{{ form.price.label_tag }}<br>{{ form.price }}</p>
    <p>{{ form.is_active.label_tag }} {{ form.is_active }}</p>

    <button type="submit">Save changes</button>
</form>

<script src="{% static 'skills/listing.js' %}"></script>
{% endblock %}

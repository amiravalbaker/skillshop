{% extends "base.html" %}
{% block content %}
<h2>Create a Listing</h2>

<form method="post">
    {% csrf_token %}

    {% if form.non_field_errors %}
    <div style="color:red;">{{ form.non_field_errors }}</div>
    {% endif %}

    <p>
    {{ form.skill_choice.label_tag }}<br>
    {{ form.skill_choice }}
  </p>

  <div id="new-skill-box" style="display:none;">
    <p>
      {{ form.new_skill.label_tag }}<br>
      {{ form.new_skill }}
    </p>
  </div>

  <p>{{ form.title.label_tag }}<br>{{ form.title }}</p>
  <p>{{ form.description.label_tag }}<br>{{ form.description }}</p>
  <p>{{ form.price.label_tag }}<br>{{ form.price }}</p>
  <p>{{ form.is_active.label_tag }} {{ form.is_active }}</p>

    <button type="submit">Create</button>
</form>

<script>
  (function() {
    const NEW_VALUE = "__new__";
    const selectEl = document.getElementById("id_skill_choice");
    const box = document.getElementById("new-skill-box");

    function toggle() {
      if (selectEl.value === NEW_VALUE) {
        box.style.display = "block";
      } else {
        box.style.display = "none";
        // clear input when not in use
        const input = document.getElementById("id_new_skill");
        if (input) input.value = "";
      }
    }

    if (selectEl) {
      selectEl.addEventListener("change", toggle);
      toggle(); // run once on page load
    }
  })();
</script>
{% endblock %}